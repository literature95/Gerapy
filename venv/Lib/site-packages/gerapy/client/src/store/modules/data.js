import * as api from '../../api/data'

const state = {
  dataList: [],
  currentData: null,
  loading: false,
  total: 0
}

const mutations = {
  SET_DATA_LIST(state, data) {
    state.dataList = data
  },
  SET_CURRENT_DATA(state, data) {
    state.currentData = data
  },
  SET_LOADING(state, status) {
    state.loading = status
  },
  SET_TOTAL(state, total) {
    state.total = total
  }
}

const actions = {
  async getDataList({ commit }, params) {
    commit('SET_LOADING', true)
    try {
      const response = await api.fetchDataList(params)
      commit('SET_DATA_LIST', response.data.items)
      commit('SET_TOTAL', response.data.total)
    } catch (error) {
      console.error('获取数据列表失败:', error)
    } finally {
      commit('SET_LOADING', false)
    }
  },
  
  async getDataDetail({ commit }, id) {
    commit('SET_LOADING', true)
    try {
      const response = await api.fetchDataDetail(id)
      commit('SET_CURRENT_DATA', response.data)
    } catch (error) {
      console.error('获取数据详情失败:', error)
    } finally {
      commit('SET_LOADING', false)
    }
  }
}

export default {
  namespaced: true,
  state,
  mutations,
  actions
}